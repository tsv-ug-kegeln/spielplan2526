<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSV UG Kegeln – Training</title>

  <style>
    :root{
      --tsv-blue:#0b3d91;
      --tsv-yellow:#f7c600;
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e2e8f0;
      --shadow:0 10px 25px rgba(2,6,23,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .header{background:linear-gradient(180deg,var(--tsv-blue),#072f70);color:white;padding:14px 14px 18px;position:sticky;top:0;z-index:10;box-shadow:0 6px 18px rgba(2,6,23,.18);}
    .header-inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:12px;}
    .logo{width:44px;height:44px;border-radius:50%;background:white;display:flex;align-items:center;justify-content:center;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.25);flex:0 0 auto;}
    .logo img{width:100%;height:100%;object-fit:cover}
    .title{display:flex;flex-direction:column;gap:2px;min-width:0;}
    .title h1{margin:0;font-size:18px;line-height:1.2}
    .title .sub{font-size:13px;color:rgba(255,255,255,.85)}
    .badge{margin-left:auto;background:rgba(247,198,0,.18);border:1px solid rgba(247,198,0,.35);color:var(--tsv-yellow);padding:6px 10px;border-radius:999px;font-size:12px;white-space:nowrap;}

    .wrap{max-width:1100px;margin:16px auto;padding:0 14px 40px}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;}
    .controls{display:grid;grid-template-columns: 1fr auto auto;gap:10px;align-items:center;}
    @media (max-width:820px){.controls{grid-template-columns:1fr 1fr}.controls .btnrow{grid-column:1/-1;display:flex;gap:10px}}
    input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--line);font-size:15px;outline:none;background:white;}
    .btn{border:0;padding:12px 14px;border-radius:12px;font-weight:600;cursor:pointer;background:var(--tsv-blue);color:white;white-space:nowrap;}
    .btn.secondary{background:white;color:var(--tsv-blue);border:1px solid rgba(11,61,145,.25);}
    .hint{margin-top:10px;color:var(--muted);font-size:13px}

    .sections{margin-top:14px;display:grid;gap:14px}
    .slot{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
    .slot-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:linear-gradient(90deg,rgba(247,198,0,.25),rgba(247,198,0,.05));border-bottom:1px solid var(--line);}
    .slot-head .time{font-weight:800;color:#0b2d66;}
    table{width:100%;border-collapse:separate;border-spacing:0;}
    th,td{padding:10px 10px;border-bottom:1px solid var(--line);font-size:14px;vertical-align:middle;}
    th{text-align:left;color:var(--muted);font-weight:700;background:#fbfdff;}
    tr:last-child td{border-bottom:0}
    .cell-edit{border-radius:10px;padding:8px 10px;border:1px solid transparent;background:transparent;min-height:36px;white-space:nowrap;}
    .cell-edit:focus{outline:none;border-color:rgba(11,61,145,.35);background:white;box-shadow:0 0 0 4px rgba(11,61,145,.10);}
    .saving{border-color:rgba(247,198,0,.6)!important;background:rgba(247,198,0,.10)!important;}
    .sum{font-weight:800;color:#0b2d66}
    .muted{color:var(--muted)}
    .col-small{width:92px}
    .errorbox{margin-top:12px;padding:12px;border:1px solid #fecaca;background:#fff1f2;border-radius:12px;color:#991b1b;}
    code{background:#f1f5f9;padding:2px 6px;border-radius:8px}
  </style>
</head>

<body>
<header class="header">
  <div class="header-inner">
    <div class="logo"><img alt="TSV Logo" src="https://tsv-ug.de/wp-content/uploads/2024/02/tsv-logo.webp"></div>
    <div class="title">
      <h1>TSV UG Kegeln – Training</h1>
      <div class="sub">Eintragen & Ergebnisse pflegen (öffentlich)</div>
    </div>
    <div class="badge" id="status">offline</div>
  </div>
</header>

<main class="wrap">
  <div class="panel">
    <div class="controls">
      <input id="search" placeholder="Suche (Name/Spieler/in) …" oninput="render()" />
      <div class="btnrow">
        <button class="btn" onclick="load()">Neu laden</button>
        <button class="btn secondary" onclick="resetFilters()">Zurücksetzen</button>
      </div>
    </div>

    <div class="hint">
      Editierbar: <b>Name</b> und <b>Bahn 1–4</b>. Gesamt kommt aus dem Sheet.
      <br>
      API: <code id="apiText"></code>
    </div>

    <div id="err"></div>
  </div>

  <div class="sections" id="sections">Lade…</div>
</main>

<script>
  // >>> HIER EINTRAGEN:
  const API_URL = "https://script.google.com/macros/s/AKfycbxlKV08yq9bhaADy9oBzYHRwj96O-PZjsysilruRzFo1SX0WGa9Cct8Lc0yL-a0VVs/exec";
  // z.B. https://script.google.com/macros/s/AKfycb.../exec

  document.getElementById('apiText').textContent = API_URL;

  let rows = [];
  let slots = [];

  function setStatus(msg){ document.getElementById('status').textContent = msg; }
  function showError(msg){
    const err = document.getElementById('err');
    err.innerHTML = msg ? `<div class="errorbox">${escapeHtml(msg)}</div>` : '';
  }
  function resetFilters(){ document.getElementById('search').value = ""; render(); }

  async function load(){
    showError("");
    setStatus("lade…");
    document.getElementById('sections').textContent = "Lade…";

    if (!API_URL || API_URL.includes("PASTE_YOUR_WEBAPP_EXEC_URL_HERE")) {
      setStatus("offline");
      showError("API_URL ist nicht gesetzt. Trage oben die WebApp-URL ein (…/exec).");
      return;
    }

    try{
      const res = await fetch(API_URL + "?action=get", { method: "GET", cache: "no-store" });
      const data = await res.json();

      if (!da
