<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spielplan 2025/26 – TSV Unterpfaffenhofen-Germering Kegeln</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f5f5f5;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 15px;
  justify-content: center;
}

select {
  padding: 5px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px 8px;
  text-align: left;
}

th {
  background: #004080;
  color: white;
}

tr:nth-child(even) {
  background: #f9f9f9;
}

.team-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.team-chip .dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.heim-auswaerts {
  white-space: nowrap;
}

.ms-alert {
  display: inline-block;
  margin-left: 4px;
  background-color: #666;
  color: #fff;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  text-align: center;
  font-size: 12px;
  line-height: 18px;
  font-weight: bold;
}

</style>
</head>
<body>

<h1>Spielplan 2025/26</h1>

<div class="filters">
  <label>Team:
    <select id="teamFilter">
      <option value="">Alle</option>
    </select>
  </label>
  <label>Gegner:
    <select id="gegnerFilter">
      <option value="">Alle</option>
    </select>
  </label>
  <label>Heim/Auswärts:
    <select id="heimFilter">
      <option value="">Alle</option>
      <option value="Heim">Heim</option>
      <option value="Auswärts">Auswärts</option>
    </select>
  </label>
</div>

<table id="spielplan">
<thead>
  <tr>
    <th>Datum</th>
    <th>Wochentag</th>
    <th>Uhrzeit</th>
    <th>Team</th>
    <th>Heim</th>
    <th></th>
    <th>Auswärts</th>
    <th>H/A</th>
    <th>Liga</th>
  </tr>
</thead>
<tbody></tbody>
</table>

<script>
let SPIELE = [];
let DATE_COUNT = {};

function fmtDE(d){
  const [y,m,day] = d.split("-");
  return `${day}.${m}.${y}`;
}

function teamColor(team){
  if (team === 'G1') return 'red';
  if (team === 'G2') return 'yellow';
  if (team === 'G3') return 'green';
  return '#ccc';
}

function render(){
  const tbody = document.querySelector('#spielplan tbody');
  tbody.innerHTML = "";
  const tf = document.getElementById('teamFilter').value;
  const gf = document.getElementById('gegnerFilter').value;
  const hf = document.getElementById('heimFilter').value;

  SPIELE.filter(r => 
    (!tf || r.Team === tf) &&
    (!gf || r.Gegner === gf) &&
    (!hf || r.HeimAuswärts === hf)
  ).forEach(r => {
    const tr = document.createElement('tr');

    // Datum + (!) falls mehrere Spiele am Tag
    const tdDate = document.createElement('td');
    tdDate.style.whiteSpace = 'nowrap';
    tdDate.textContent = fmtDE(r.Datum);
    if ((DATE_COUNT[r.Datum]||0) > 1){
      const alert = document.createElement('span');
      alert.className = 'ms-alert';
      alert.textContent = '!';
      tdDate.appendChild(alert);
    }
    tr.appendChild(tdDate);

    tr.innerHTML += `
      <td>${r.Wochentag||''}</td>
      <td>${r.Uhrzeit||''}</td>
      <td>
        <span class="team-chip">
          <span class="dot" style="background:${teamColor(r.Team||'')}"></span>
          ${r.Team||''}
        </span>
      </td>
      <td>${r.Heim||''}</td>
      <td style="text-align:center">–</td>
      <td>${r.Auswärts||''}</td>
      <td class="heim-auswaerts">${r.HeimAuswärts||''}</td>
      <td>${r.Liga||''}</td>
    `;
    tbody.appendChild(tr);
  });
}

fetch('tsv_spiele_gesamt.json')
  .then(r => r.json())
  .then(data => {
    SPIELE = data;
    DATE_COUNT = {};
    SPIELE.forEach(r => {
      DATE_COUNT[r.Datum] = (DATE_COUNT[r.Datum]||0)+1;
    });
    const teamSet = new Set(), gegnerSet = new Set();
    SPIELE.forEach(r=>{
      teamSet.add(r.Team);
      gegnerSet.add(r.Gegner);
    });
    const tsel = document.getElementById('teamFilter');
    [...teamSet].sort().forEach(t=>{
      const opt = document.createElement('option');
      opt.value = t;
      opt.textContent = t;
      tsel.appendChild(opt);
    });
    const gsel = document.getElementById('gegnerFilter');
    [...gegnerSet].sort().forEach(t=>{
      const opt = document.createElement('option');
      opt.value = t;
      opt.textContent = t;
      gsel.appendChild(opt);
    });
    render();
  });

document.querySelectorAll('.filters select').forEach(sel=>{
  sel.addEventListener('change', render);
});
</script>

</body>
</html>
